# **Magic 8 ball** for Telegram
![Python](https://img.shields.io/badge/-Python-191970?style=flat&logo=python&logoColor=white)
![Telegram](https://img.shields.io/badge/-Telegram-4682B4?style=flat&logo=telegram&logoColor=white)


## Описание проекта
**Magic 8 ball** – знаменитый шар предсказаний. Возможно, знакомый вам по культовому фильму **Трасса 60**. Данный проект его цифровой аналог для мессенджера **Telegram**. Перейдите по [ссылке](https://t.me/magic_b8ll_bot) и задайте ему вопрос о своем будущем!
## Регистрируем бота
В окне поиска контактов в **Telegram** введите **@BotFather** и начните с ним диалог нажатием кнопки **Start**. Затем отправьте команду ```/newbot``` и укажите параметры нового бота:
- **имя** (на любом языке), под которым ваш бот будет отображаться в списке контактов;е
- **техническое имя вашего бота** по которому его можно будет найти в Telegram. Имя должно оканчиваться на слово bot в любом регистре

Аккаунт вашего бота создан. **BotFather** поздравит вас и отправит в чат токен для работы с Bot API. Токен выглядит примерно так: ```123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11```
## Заселяем бота на сервер
```Примечание: дальнейшии инструкции составлены на основе работы с сервером на OS Ubuntu 20.04. Однако алгоритм действий запуска проекта на локальной машине аналогичен.```

Клонируйте данный репозиторий в рабочую директорию на сервере и перейдите в нее:
```
git clone git@github.com:Belyanski/magic_8_ball.git
```
```
cd magic_8_ball/
```
Cоздайте и активируйте виртуальное окружение:
```
python3 -m venv venv
```
```
source venv/bin/activate
```
Установите зависимости проекта:
```
pip install -r requirements.txt
``` 
В корневой директории проекта создайте файл для секретов:
```
nano .env
```
Вы окажетесь в редакторе **nano**, где вам необходимо прописать токен, полученный от **BotFather**: 
```
TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
```
Затем нажмите ```Ctrl+X```, согласитесь с сохранением изменений ```Y``` и подтвердите название файла ```Enter```

Запустите бота:
```
python main.py
```
Теперь вы можете задавать своему боту вопросы и он будет на них отвечать! Когда вы узнаете достатчоно, выключите его сочетанием клавиш ```Ctrl+C```.
## Режим демона

Хороший бот тот бот, к которому можно обратиться в любое время дня и ночи. За исправной работой которого не надо следить. Сейчас мы сделаем так, чтобы ваш бот работал на сервере как часы и в случае сбоев сам себя перезагружал.

Сперва нужно создать юнита для системного демона ```systemd```:
```
sudo nano /etc/systemd/system/magic_ball.service # Для юнита допустимо любое другое название
```
Запишите следующий код из листинга:
```
[Unit]
Description=Telegram Magic 8 Ball
After=syslog.target
After=network.target

[Service]
Type=simple
User=root  # Необходимо заменить на имя пользователя вашего сервера
WorkingDirectory=/root/magic_8_ball  # Рабочая директория, может отличаться от вашей 
ExecStart=/root/magic_8_ball/venv/bin/python /root/magic_8_ball/main.py  # Путь до Python и исполняемого файла
RestartSec=10
Restart=always
 
[Install]
WantedBy=multi-user.target
```
Затем нажмите ```Ctrl+X```, согласитесь с сохранением изменений ```Y``` и подтвердите название файла ```Enter```.

Далее введите последовательно следующие команды: 

```
systemctl daemon-reload
systemctl enable magic_ball
systemctl start magic_ball
systemctl status magic_ball
```
Теперь бот работает в фоновом режиме и всегда с вами!


#### Автор проекта
[Ярослав Белянский](https://github.com/Belyanski)
